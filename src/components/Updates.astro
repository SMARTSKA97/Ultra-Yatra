---
import { getCollection, type CollectionEntry } from "astro:content";

const title = Astro.props?.title ?? "Updates";

// Fetch ALL posts
const allPosts: CollectionEntry<"posts">[] = await getCollection("posts");

// Filter for any post that is NOT 'Published'
const upcomingPosts = allPosts
  .filter((p: CollectionEntry<"posts">) => p.data.status !== "Published")
  .sort((a: CollectionEntry<"posts">, b: CollectionEntry<"posts">) => 
    new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime()
  )
  .slice(0, 5);
---
<section class="card" style="padding:1rem;">
  <h3 style="margin:.25rem 0 .75rem">{title}</h3>
  <div id="updates" class="meta">
    {upcomingPosts.length === 0 ? (
      <span class="meta">No updates yet.</span>
    ) : (
      upcomingPosts.map(i => (
        <div style="margin:.5rem 0;">
          <div style="font-weight:600">{i.data.title}</div>
          <div style="font-size:.85rem; opacity:.75">
            (Status: {i.data.status}) <!-- Shows 'Draft' or 'Not started' -->
          </div>
          {i.data.excerpt && <div style="margin-top:.25rem">{i.data.excerpt}</div>}
        </div>
      ))
    )}
  </div>
</section>


